# üê± Cat Service

–°–µ—Ä–≤–∏—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–∏–ª—ã—Ö –∫–æ—Ç–∏–∫–æ–≤ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥–æ–º. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –∏ —Ç–æ–ø —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–æ—Ç–∏–∫–æ–≤.

**API**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç [The Cat API](https://thecatapi.com/) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∫–æ—Ç–∏–∫–æ–≤ (–ª–∏–º–∏—Ç: 100 –∑–∞–ø—Ä–æ—Å–æ–≤).

## üìö –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [–ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞](#–∑–∞–ø—É—Å–∫-–ø—Ä–æ–µ–∫—Ç–∞)
- [–î–æ—Å—Ç—É–ø–Ω—ã–µ –∞–¥—Ä–µ—Å–∞](#–¥–æ—Å—Ç—É–ø–Ω—ã–µ-–∞–¥—Ä–µ—Å–∞)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–ê–ª–µ—Ä—Ç—ã](#–∞–ª–µ—Ä—Ç—ã)

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone <repository-url>
cd o11y
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:
```bash
docker-compose up -d
```

–í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –±—É–¥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Docker.

## üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ –∞–¥—Ä–µ—Å–∞

- **–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å**: http://localhost:3000
  - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∫–æ—Ç–∏–∫–∞–º–∏
  - –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
  - –¢–æ–ø –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–æ—Ç–∏–∫–æ–≤

- **Swagger**: http://localhost:3000/api-docs
  - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
  - –¢–µ—Å—Ç–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
  - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

- **Grafana**: http://localhost:3000/grafana
  - –î–∞—à–±–æ—Ä–¥—ã —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
  - –õ–æ–≥–∏–Ω: admin
  - –ü–∞—Ä–æ–ª—å: admin

- **Prometheus**: http://localhost:9090
  - –ú–µ—Ç—Ä–∏–∫–∏
  - –ê–ª–µ—Ä—Ç—ã
  - PromQL –∑–∞–ø—Ä–æ—Å—ã

- **Alertmanager**: http://localhost:9093
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–ª–µ—Ä—Ç–∞–º–∏
  - –ò—Å—Ç–æ—Ä–∏—è –∞–ª–µ—Ä—Ç–æ–≤

- **Locust**: http://localhost:8089
  - –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  - –ì—Ä–∞—Ñ–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏
- HTTP –∑–∞–ø—Ä–æ—Å—ã (latency, RPS)
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î (RPS, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
- –í–Ω–µ—à–Ω–∏–π API (latency, –æ—à–∏–±–∫–∏)
- –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (CPU, Memory)

### –î–∞—à–±–æ—Ä–¥—ã
- **Cat Service Overview**: –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
- **Database Metrics**: –º–µ—Ç—Ä–∏–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **API Metrics**: –º–µ—Ç—Ä–∏–∫–∏ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–í—Å–µ –∫–æ–Ω—Ñ–∏–≥–∏ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ –∞–ª–µ—Ä—Ç–æ–≤ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤:
- `monitoring/prometheus.yml` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus
- `monitoring/alert.rules.yml` - –ø—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤
- `monitoring/alertmanager.yml` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `monitoring/grafana/provisioning/dashboards/` - –¥–∞—à–±–æ—Ä–¥—ã Grafana

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Locust)

–î–ª—è –∑–∞–ø—É—Å–∫–∞ Locust –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Python. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:
```bash
cd cat-service/load_test
./run_locust.sh
```

–ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:
```bash
cd cat-service/load_test
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
locust -f locustfile.py --host http://localhost:3000
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª–µ—Ä—Ç–æ–≤

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–ª–µ—Ä—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:
```bash
cd cat-service
node test_alerts.js
```

–°–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –∞–ª–µ—Ä—Ç—ã **–ë–ï–ó –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è The Cat API** (—á—Ç–æ–±—ã –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –ª–∏–º–∏—Ç –≤ 100 –∑–∞–ø—Ä–æ—Å–æ–≤):
1. **High DB RPS** (60 —Å–µ–∫—É–Ω–¥) - —á–µ—Ä–µ–∑ `/api/test/dbload`
2. **High API RPS** (60 —Å–µ–∫—É–Ω–¥) - —á–µ—Ä–µ–∑ `/api/test/latency`
3. **High Latency** (60 —Å–µ–∫—É–Ω–¥) - —á–µ—Ä–µ–∑ `/api/test/latency?ms=1000`
4. **5xx Errors** (60 —Å–µ–∫—É–Ω–¥) - —á–µ—Ä–µ–∑ `/api/test/error`

–ú–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏ –¥–µ–ª–∞–µ—Ç—Å—è –ø–∞—É–∑–∞ 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∞–ª–µ—Ä—Ç–æ–≤.

**–í–∞–∂–Ω–æ**: –°–∫—Ä–∏–ø—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/api/cat` —ç–Ω–¥–ø–æ–∏–Ω—Ç, —á—Ç–æ–±—ã –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ The Cat API.

## ‚ö†Ô∏è –ê–ª–µ—Ä—Ç—ã

–í—Å–µ –∞–ª–µ—Ä—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Telegram –∫–∞–Ω–∞–ª [@CatApiAlerts](https://t.me/CatApiAlerts)

### –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤:
- **CatServiceP99Latency**: P99 latency > 500ms
- **CatServiceHighDbRPS**: DB –æ–ø–µ—Ä–∞—Ü–∏–π > 100 RPS
- **CatServiceHighApiRPS**: API –∑–∞–ø—Ä–æ—Å–æ–≤ > 100 RPS
- **CatServiceHighDbSaveRPS**: DB —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π > 80 RPS
- **CatServiceCatApiSlow**: P95 latency –≤–Ω–µ—à–Ω–µ–≥–æ API > 1s
- **CatService5xxErrors**: –õ—é–±—ã–µ 5xx –æ—à–∏–±–∫–∏

### –ö–∞–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∞–ª–µ—Ä—Ç—ã:
1. **P99 Latency**: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç —Å –≤—ã—Å–æ–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
   ```bash
   curl "http://localhost:3000/api/test/latency?ms=600"
   ```

2. **High DB RPS**: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —Ç–µ—Å—Ç –ë–î
   ```bash
   curl -X POST "http://localhost:3000/api/test/dbload?count=200"
   ```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `test_alerts.js` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –∞–ª–µ—Ä—Ç–æ–≤.